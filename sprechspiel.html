<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Rhetorik & Logik – Sprechspiel</title>
  <style>
    :root {
      --bg-1: #101b2c;
      --bg-2: #203252;
      --bg-3: #2d4268;
      --accent-1: #ffb703;
      --accent-2: #fb8500;
      --accent-3: #8ecae6;
      --accent-4: #219ebc;
      --card: #f6f1e9;
      --ink: #0b1324;
      --muted: #5a6b84;
      --good: #2d6a4f;
      --bad: #9b2226;
      --shadow: 0 16px 30px rgba(0,0,0,0.25);
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: "Futura", "Avenir Next", "Gill Sans", sans-serif;
      color: #eef2ff;
      background: radial-gradient(1200px 800px at 12% 10%, #2f456b 0%, #203252 45%, #101b2c 100%);
      min-height: 100vh;
    }

    header {
      padding: 22px 26px 10px;
    }

    h1 {
      margin: 0 0 6px 0;
      font-weight: 800;
      letter-spacing: 0.6px;
      text-transform: uppercase;
    }

    .subtitle {
      color: #cbd5e1;
      font-size: 0.98rem;
      max-width: 900px;
    }

    .wrap {
      display: grid;
      grid-template-columns: minmax(280px, 360px) 1fr;
      gap: 18px;
      padding: 0 24px 24px;
    }

    @media (max-width: 1100px) {
      .wrap { grid-template-columns: 1fr; }
    }

    .panel {
      background: linear-gradient(160deg, rgba(255,255,255,0.08), rgba(255,255,255,0.03));
      border: 1px solid rgba(255,255,255,0.08);
      padding: 16px;
      border-radius: 18px;
      box-shadow: var(--shadow);
      backdrop-filter: blur(6px);
    }

    .panel h2 {
      margin: 0 0 8px 0;
      font-size: 1.05rem;
      text-transform: uppercase;
      letter-spacing: 0.8px;
    }

    .btn-row {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 10px;
    }

    button {
      cursor: pointer;
      border: none;
      border-radius: 12px;
      padding: 10px 12px;
      font-weight: 700;
      letter-spacing: 0.3px;
      transition: transform 0.12s ease, box-shadow 0.12s ease;
    }

    button:hover { transform: translateY(-1px); }

    .btn-primary { background: var(--accent-1); color: #1c1400; }
    .btn-secondary { background: var(--accent-4); color: #e6f6ff; }
    .btn-ghost { background: transparent; color: #e2e8f0; border: 1px solid rgba(255,255,255,0.2); }
    .btn-warn { background: #ef476f; color: #fff; }

    .status {
      margin-top: 8px;
      font-size: 0.88rem;
      color: #dbeafe;
    }

    .toggle {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-top: 12px;
      font-size: 0.92rem;
      color: #dbeafe;
    }

    .toggle input {
      transform: scale(1.1);
    }

    .chip-row {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      margin-top: 8px;
    }

    .chip {
      background: #0b1627;
      border: 1px solid rgba(255,255,255,0.12);
      padding: 6px 10px;
      border-radius: 999px;
      font-size: 0.82rem;
      color: #e2e8f0;
    }

    .card {
      background: var(--card);
      color: var(--ink);
      padding: 18px;
      border-radius: 18px;
      box-shadow: var(--shadow);
      min-height: 220px;
      display: flex;
      flex-direction: column;
      gap: 12px;
      position: relative;
      overflow: hidden;
    }

    .prompt {
      font-size: 1.08rem;
      font-weight: 700;
      margin: 0;
    }

    .hint {
      color: var(--muted);
      font-size: 0.92rem;
      margin: 0;
    }

    .speech-box {
      background: #0b1627;
      color: #e2e8f0;
      padding: 12px;
      border-radius: 12px;
      min-height: 90px;
      border: 1px solid rgba(255,255,255,0.08);
      font-size: 0.95rem;
    }

    textarea {
      width: 100%;
      min-height: 70px;
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.2);
      background: #0b1627;
      color: #e2e8f0;
      font-family: inherit;
      font-size: 0.95rem;
      resize: vertical;
    }

    .feedback {
      padding: 12px;
      border-radius: 12px;
      font-weight: 700;
      font-size: 0.98rem;
    }

    .feedback.good { background: #d8f3dc; color: #1b4332; }
    .feedback.bad { background: #ffe4e6; color: #7f1d1d; }

    .score {
      display: grid;
      grid-template-columns: repeat(3, minmax(60px, 1fr));
      gap: 8px;
      margin-top: 10px;
    }

    .score-box {
      background: #0b1627;
      border: 1px solid rgba(255,255,255,0.12);
      padding: 10px;
      border-radius: 12px;
      text-align: center;
    }

    .score-box strong { display: block; font-size: 1.2rem; }

    .fade-in {
      animation: fadeIn 0.35s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(6px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>
<body>
  <header>
    <h1>Rhetorik & Logik – Sprechspiel</h1>
    <div class="subtitle">
      Sprich deine Beispiele ein: Erfinde eine rhetorische Figur oder einen logischen Schluss.
      Das Spiel prüft per einfacher Regel‑Logik, ob dein Beispiel passt.
    </div>
  </header>

  <div class="wrap">
    <aside class="panel">
      <h2>Steuerung</h2>
      <div class="btn-row">
        <button class="btn-primary" id="btnListen">Aufnehmen</button>
        <button class="btn-warn" id="btnStop" disabled>Stop</button>
        <button class="btn-secondary" id="btnCheck">Bewerten</button>
        <button class="btn-ghost" id="btnNext">Neue Aufgabe</button>
      </div>
      <div class="status" id="statusLine">Bereit für die Aufnahme.</div>

      <label class="toggle">
        <input type="checkbox" id="toggleHints" />
        Hinweise anzeigen
      </label>

      <div class="score">
        <div class="score-box"><strong id="scoreCorrect">0</strong>Korrekt</div>
        <div class="score-box"><strong id="scoreWrong">0</strong>Falsch</div>
        <div class="score-box"><strong id="scoreTotal">0</strong>Gesamt</div>
      </div>

      <div class="chip-row" id="chipRow"></div>
    </aside>

    <main class="panel">
      <h2>Aufgabe</h2>
      <div class="card">
        <div>
          <div class="chip" id="taskType">Rhetorische Figur</div>
        </div>
        <p class="prompt" id="taskPrompt"></p>
        <p class="hint" id="taskHint" style="display:none;"></p>
        <div>
          <div class="hint">Live‑Transkript:</div>
          <div class="speech-box" id="liveTranscript"></div>
        </div>

        <div>
          <div class="hint">Falls das Mikro blockiert ist, kannst du hier tippen:</div>
          <textarea id="manualInput" placeholder="Dein gesprochenes Beispiel hier einfügen"></textarea>
        </div>

        <div id="feedbackBox" class="feedback" style="display:none;"></div>
      </div>
    </main>
  </div>

  <script>
    const challenges = [
      {
        type: "Rhetorische Figur",
        label: "Rhetorische Frage",
        prompt: "Formuliere eine rhetorische Frage.",
        hint: "Beispiel: „Muss das wirklich sein?“",
        check: (text) => {
          const qWords = ["wer", "was", "warum", "wieso", "wie", "wo", "wann", "wozu", "welche", "welcher", "welches"];
          return qWords.some((w) => hasWord(text, w));
        }
      },
      {
        type: "Rhetorische Figur",
        label: "Alliteration",
        prompt: "Bilde eine Alliteration (mehrere Wörter mit gleichem Anfangsbuchstaben).",
        hint: "Beispiel: „Milch macht müde Männer munter.“",
        check: (text) => hasAlliteration(text)
      },
      {
        type: "Rhetorische Figur",
        label: "Hyperbel",
        prompt: "Gib eine Übertreibung (Hyperbel) an.",
        hint: "Beispiel: „Ich habe tausend Jahre gewartet.“",
        check: (text) => {
          const cues = ["tausend", "million", "milliarde", "endlos", "unendlich", "riesig", "ewig", "immer", "niemals"];
          return cues.some((w) => hasWord(text, w));
        }
      },
      {
        type: "Rhetorische Figur",
        label: "Anapher",
        prompt: "Formuliere eine Anapher (gleicher Wortanfang in zwei Sätzen oder Teilsätzen).",
        hint: "Beispiel: „Wir fordern Gerechtigkeit. Wir fordern Respekt.“",
        check: (text) => hasAnaphora(text)
      },
      {
        type: "Logischer Schluss",
        label: "Modus Ponens",
        prompt: "Sprich einen Modus‑Ponens‑Schluss: „Wenn es regnet, wird die Straße nass. Es regnet. Also wird die Straße nass.“",
        hint: "Achte darauf, die Wörter „regnet“, „Straße“, „nass“, „also“ zu sagen.",
        check: (text) => requireWords(text, ["regnet", "straße", "nass", "also"])
      },
      {
        type: "Logischer Schluss",
        label: "Modus Tollens",
        prompt: "Sprich einen Modus‑Tollens‑Schluss: „Wenn die Lampe an ist, ist es hell. Es ist nicht hell. Also ist die Lampe nicht an.“",
        hint: "Achte darauf, die Wörter „Lampe“, „hell“, „nicht“, „also“ zu sagen.",
        check: (text) => requireWords(text, ["lampe", "hell", "nicht", "also"])
      },
      {
        type: "Logischer Schluss",
        label: "Syllogismus",
        prompt: "Sprich einen klassischen Syllogismus: „Alle Menschen sind sterblich. Sokrates ist ein Mensch. Also ist Sokrates sterblich.“",
        hint: "Achte darauf, die Wörter „Menschen“, „sterblich“, „Sokrates“, „also“ zu sagen.",
        check: (text) => requireWords(text, ["menschen", "sterblich", "sokrates", "also"])
      }
    ];

    const ui = {
      taskType: document.getElementById("taskType"),
      taskPrompt: document.getElementById("taskPrompt"),
      taskHint: document.getElementById("taskHint"),
      liveTranscript: document.getElementById("liveTranscript"),
      manualInput: document.getElementById("manualInput"),
      feedbackBox: document.getElementById("feedbackBox"),
      statusLine: document.getElementById("statusLine"),
      chipRow: document.getElementById("chipRow"),
      scoreCorrect: document.getElementById("scoreCorrect"),
      scoreWrong: document.getElementById("scoreWrong"),
      scoreTotal: document.getElementById("scoreTotal"),
      btnListen: document.getElementById("btnListen"),
      btnStop: document.getElementById("btnStop"),
      btnCheck: document.getElementById("btnCheck"),
      btnNext: document.getElementById("btnNext"),
      toggleHints: document.getElementById("toggleHints")
    };

    let current = null;
    let correct = 0;
    let wrong = 0;
    let recognition = null;
    let listening = false;
    let lastTranscript = "";

    function normalize(text) {
      return text
        .toLowerCase()
        .replace(/ä/g, "ae")
        .replace(/ö/g, "oe")
        .replace(/ü/g, "ue")
        .replace(/ß/g, "ss")
        .replace(/[^\w\s]/g, " ")
        .replace(/\s+/g, " ")
        .trim();
    }

    function words(text) {
      const cleaned = normalize(text);
      return cleaned.length ? cleaned.split(" ") : [];
    }

    function hasWord(text, word) {
      const cleaned = normalize(text);
      const safe = normalize(word);
      const re = new RegExp(`\\b${safe}\\b`, "i");
      return re.test(cleaned);
    }

    function requireWords(text, list) {
      return list.every((w) => hasWord(text, w));
    }

    function hasAlliteration(text) {
      const w = words(text).filter((t) => t.length > 2);
      for (let i = 0; i < w.length - 1; i += 1) {
        const a = w[i][0];
        const b = w[i + 1][0];
        if (a && a === b) return true;
      }
      return false;
    }

    function hasAnaphora(text) {
      const w = words(text);
      if (w.length < 4) return false;
      const first = w[0];
      for (let i = 1; i < Math.min(6, w.length); i += 1) {
        if (w[i] === first) return true;
      }
      return false;
    }

    function setChallenge(challenge) {
      current = challenge;
      ui.taskType.textContent = challenge.type;
      ui.taskPrompt.textContent = challenge.prompt;
      ui.taskHint.textContent = challenge.hint;
      ui.taskHint.style.display = ui.toggleHints.checked ? "block" : "none";
      ui.feedbackBox.style.display = "none";
      ui.feedbackBox.textContent = "";
      ui.feedbackBox.className = "feedback";
      ui.liveTranscript.textContent = "";
      ui.manualInput.value = "";
      lastTranscript = "";

      ui.chipRow.innerHTML = "";
      const chips = [
        `Typ: ${challenge.type}`,
        `Ziel: ${challenge.label}`,
        "Eingabe: Sprache"
      ];
      chips.forEach((text) => {
        const chip = document.createElement("div");
        chip.className = "chip";
        chip.textContent = text;
        ui.chipRow.appendChild(chip);
      });
    }

    function pickChallenge() {
      const index = Math.floor(Math.random() * challenges.length);
      setChallenge(challenges[index]);
    }

    function updateScores() {
      ui.scoreCorrect.textContent = String(correct);
      ui.scoreWrong.textContent = String(wrong);
      ui.scoreTotal.textContent = String(correct + wrong);
    }

    function showFeedback(ok, message) {
      ui.feedbackBox.style.display = "block";
      ui.feedbackBox.className = `feedback ${ok ? "good" : "bad"} fade-in`;
      ui.feedbackBox.textContent = message;
    }

    function getAnswerText() {
      const typed = ui.manualInput.value.trim();
      if (typed.length > 0) return typed;
      return lastTranscript;
    }

    function evaluate() {
      if (!current) return;
      const answer = getAnswerText();
      if (!answer) {
        showFeedback(false, "Ich habe noch keine Eingabe erkannt. Bitte sprich oder tippe dein Beispiel.");
        return;
      }

      const ok = current.check(answer);
      if (ok) {
        correct += 1;
        showFeedback(true, "Korrekt! Dein Beispiel passt zur Aufgabe.");
      } else {
        wrong += 1;
        showFeedback(false, "Noch nicht passend. Versuche, die Hinweise genauer zu erfüllen.");
      }
      updateScores();
    }

    function setupSpeech() {
      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      if (!SpeechRecognition) {
        ui.statusLine.textContent = "Spracherkennung wird von diesem Browser nicht unterstützt.";
        ui.btnListen.disabled = true;
        ui.btnStop.disabled = true;
        return;
      }

      recognition = new SpeechRecognition();
      recognition.lang = "de-DE";
      recognition.interimResults = true;
      recognition.continuous = false;

      recognition.addEventListener("result", (event) => {
        let transcript = "";
        for (let i = event.resultIndex; i < event.results.length; i += 1) {
          transcript += event.results[i][0].transcript;
        }
        lastTranscript = transcript.trim();
        ui.liveTranscript.textContent = lastTranscript || "…";
      });

      recognition.addEventListener("start", () => {
        listening = true;
        ui.statusLine.textContent = "Aufnahme läuft – sprich jetzt.";
        ui.btnListen.disabled = true;
        ui.btnStop.disabled = false;
      });

      recognition.addEventListener("end", () => {
        listening = false;
        ui.statusLine.textContent = "Aufnahme beendet.";
        ui.btnListen.disabled = false;
        ui.btnStop.disabled = true;
      });

      recognition.addEventListener("error", () => {
        ui.statusLine.textContent = "Fehler bei der Spracherkennung. Bitte Mikrofon erlauben oder tippen.";
        ui.btnListen.disabled = false;
        ui.btnStop.disabled = true;
      });
    }

    ui.btnListen.addEventListener("click", () => {
      if (recognition && !listening) {
        ui.liveTranscript.textContent = "";
        recognition.start();
      }
    });

    ui.btnStop.addEventListener("click", () => {
      if (recognition && listening) {
        recognition.stop();
      }
    });

    ui.btnCheck.addEventListener("click", evaluate);
    ui.btnNext.addEventListener("click", pickChallenge);
    ui.toggleHints.addEventListener("change", () => {
      ui.taskHint.style.display = ui.toggleHints.checked ? "block" : "none";
    });

    setupSpeech();
    pickChallenge();
    updateScores();
  </script>
</body>
</html>
